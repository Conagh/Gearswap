function get_sets()
    sets = {}
         
    sets.aftercast_Idle_noSub = {main="Lehbrailg +2",sub="",ammo="Incantor Stone",
        head="Nefer Khat",neck="Twilight Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
        body="Heka's Kalasiris",hands="Serpentes Cuffs",ring1="Bifrost Ring",ring2="Dark Ring",
        back="Shadow Mantle",waist="Korin Obi",legs="Nares Trews",feet="Serpentes Sabots"}
     
    sets.aftercast_Idle_Sub = {main="Lehbrailg +2",sub="",ammo="Incantor Stone",
        head="Nefer Khat",neck="Twilight Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
        body="Heka's Kalasiris",hands="Serpentes Cuffs",ring1="Bifrost Ring",ring2="Dark Ring",
        back="Shadow Mantle",waist="Korin Obi",legs="Nares Trews",feet="Serpentes Sabots"}
	
	sets.aftercast_IdleStun = {main="Apamajas II",sub="Mephitis Grip",ammo="Inacantor Stone",
        head="Nahtirah Hat",neck="Eddy Necklace",ear1="Lifestorm Earring",ear2="Psystorm Earring",
        body="Hedera Cotehardie",hands="Gendewitha Gages",ring1="Sangoma Ring",ring2="Maquette Ring",
        back="Swith Cape",waist="Goading Belt",legs="Artsieq Hose",feet="Peda. Loafers"}

		sets.ExtremeStun = {main="Lehbrailg +2",sub="Mephitis Grip",ammo="Inacantor Stone",
        head="Nahtirah Hat",neck="Eddy Necklace",ear1="Lifestorm Earring",ear2="Psystorm Earring",
        body="Hedera Cotehardie",hands="Gendewitha Gages",ring1="Sangoma Ring",ring2="Maquette Ring",
        back="Swith Cape",waist="Goading Belt",legs="Artsieq Hose",feet="Peda. Loafers"}

		
	sets.aftercast_IdleNight = {main="Lehbrailg +2",sub="",ammo="Incantor Stone",
		head="Nefer Khat",neck="Twilight Torque",ear1="Merman's Earring",ear2="Coral Earring",
		body="Heka's Kalasiris",hands="Serpentes Cuffs",ring1="Dark ring",ring2="Patricius Ring",
		back="Cheviot Cape",waist="Siegel Sash",legs="Nares Trews",feet="Theo. Duckbills +1"}
	
	sets.aftercast_Idle119 = {main="Lehbrailg +2",ammo="Incantor Stone",
		head="Hagondes Hat",neck="Twilight Torque",ear1="Merman's Earring",ear2="Coral Earring",
		body="Hagondes Coat",hands="Gendewitha Gages",ring1="Dark ring",ring2="Patricius Ring",
		back="Cheviot Cape",waist="Siegel Sash",legs="Artsieq Hose",feet="Gendewitha Galoshes"}
	
	sets.aftercast_IdleDay = {main="Lehbrailg +2",sub="",ammo="Incantor Stone",
		head="Nefer Khat",neck="Twilight Torque",ear1="Merman's Earring",ear2="Coral Earring",
		body="Heka's Kalasiris",hands="Lurid Mitts",ring1="Dark ring",ring2="Patricius Ring",
		back="Cheviot Cape",waist="Siegel Sash",legs="Nares Trews",feet="Serpentes Sabots"}
	
    sets.aftercast_Move = {main="Lehbrailg +2",sub="",ammo="Incantor Stone",
        head="Nefer Khat",neck="Twilight Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
        body="Heka's Kalasiris",hands="Serpentes Cuffs",ring1="Bifrost Ring",ring2="Dark Ring",
        back="Shadow Mantle",waist="Korin Obi",legs="Nares Trews",feet="Desert boots"}
		
    sets.aftercast_Idle = sets.aftercast_Idle_noSub
         
    sets.precast_FastCast = {ammo="Incantor Stone",head="Nahtirah Hat",ear2="Loquacious Earring",
        body="Anhur Robe",hands="Gendewitha Gages",back="Swith Cape",legs="Artseiq hose",feet="Peda. Loafers"}
     
    sets.Resting = {main="Chatoyant Staff",sub="Mephitis Grip",
		head="Nahtirah Hat",neck="Twilight Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
		body="Hagondes Coat",hands="Nares Cuffs",ring1="Sangoma Ring",ring2="Maquette Ring",
		back="Shadow Mantle",waist="Korin Obi",legs="Nares Trews",feet="Chelona Boots"}
	
	--MAB Sets--
	sets.midcast_ElementalMagic = {}
	
    sets.midcast_ElementalMagic.index = {'Standard','Accuracy'}
    midcast_ElementalMagic_ind = 1
	
    sets.midcast_ElementalMagic.Standard = {
		main="Lehbrailg +2",
		sub="Mephitis Grip",
		ammo="Savant's Treatise",
		head="Hagondes Hat",
		body="Hagondes Coat",
		hands= "Hagondes Cuffs +1",
		legs="Hagondes Pants +1",
		feet="Umbani boots",
		neck="Eddy Necklace",
		waist="Aswang Sash",
		left_ear="Friomisi Earring",
		right_ear="Hecate's Earring",
		left_ring="Icesoul Ring",
		right_ring="Sangoma Ring",
		back="Toro Cape"}
    
    sets.midcast_ElementalMagic.Accuracy = {
		main="Lehbrailg +2",
		sub="Mephitis Grip",
		ammo="Savant's Treatise",
		head="Hagondes Hat",
		body="Hagondes Coat",
		hands= "Hagondes Cuffs +1",
		legs="Hagondes Pants +1",
		feet="Umbani boots",
		neck="Eddy Necklace",
		waist="Aswang Sash",
		left_ear="Friomisi Earring",
		right_ear="Hecate's Earring",
		left_ring="Icesoul Ring",
		right_ring="Sangoma Ring",
		back="Toro Cape"}
	
    sets.midcast_DarkMagic = {main="Chatoyant Staff",sub="Arbuda Grip",ammo="Hasty Pinion",
        head="Appetence Crown",neck="Aesir Torque",ear1="Hirudinea Earring",ear2="Loquacious Earring",
        body="Hedera Cotehardie",hands="Ayao's Gages",ring1="Balrahn's Ring",ring2="Excelsis Ring",
        back="Merciful Cape",waist="Goading Belt",legs="Auspex Slops",feet="Hag. Sabots +1"}
     
    sets.midcast_EnfeeblingMagic = {main="Lehbrailg +2",sub="Mephitis Grip",ammo="Savant's Treatise",
        head="Nahtirah Hat",neck="Eddy Necklace",ear1="Lifestorm Earring",ear2="Psystorm Earring",
        body="Hedera Cotehardie",hands="Lurid Mitts",ring1="Sangoma Ring",ring2="Maquette Ring",
        back="Refraction Cape",waist="Cascade Belt",legs="Artseiq hose",feet="Hag. Sabots +1"}
     
    sets.midcast_Impact = {main="Lehbrailg +2",sub="Wizzan Grip",ammo="Witchstone",
        neck="Eddy Necklace",ear1="Hecate's Earring",ear2="Novio Earring",
        hands="Yaoyotl Gloves",ring1="Strendu Ring",ring2="Icesoul Ring",body="Hagondes Coat",
        back="Searing Cape",waist="Maniacus Sash",legs="Hagondes Pants",feet="Hag. Sabots +1"}
     
    sets.midcast_Embrava = {main="Kirin's Pole",sub="Fulcio Grip",ammo="Savant's Treatise",
        head="Svnt. Bonnet +2",neck="Colossus's Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
        body="Anhur Robe",hands="Savant's Bracers +2",
        back="Merciful Cape",waist="Cascade Belt",legs="Shedir Seraweels",feet="Rubeus Boots"}
     
    sets.midcast_EnhancingMagic = {main="Kirin's Pole",sub="Fulcio Grip",ammo="Incantor Stone",
        head="Svnt. Bonnet +2",neck="Colossus's Torque",ear1="Lifestorm Earring",ear2="Loquacious Earring",
        body="Anhur Robe",hands="Gendewitha Gages",
        back="Swith Cape",waist="Ninurta's Sash",legs="Artseiq hose",feet="Peda. Loafers"}
     
    sets.precast_Stun = {main="Apamajas II",sub="Mephitis Grip",ammo="Inacantor Stone",
        head="Nahtirah Hat",neck="Eddy Necklace",ear1="Lifestorm Earring",ear2="Psystorm Earring",
        body="Hedera Cotehardie",hands="Gendewitha Gages",ring1="Sangoma Ring",ring2="Maquette Ring",
        back="Swith Cape",waist="Goading Belt",legs="Artsieq Hose",feet="Peda. Loafers"}
         
     
    sets.midcast_Cure = {main="Tamaxchi",sub="",head="Hyksos Khat +1",neck="Healing Torque",
    body="Heka's Kalasiris",hands="Bokwus Gloves",back="Oretanis's Cape",legs="Scholar's Pants",
	feet="Peda. Loafers",ring1="Sirona's Ring",ring2="Ephedra Ring",ear1="Beatific Earring",
	Ear2="Lifestorm Earring"}
     
    sets.midcast_Helix = {main="Lehbrailg +2",sub="Wize Grip",ammo="Witchstone",
        head="Hagondes Hat",neck="Stoicheion Medal",ear1="Hecate's Earring",ear2="Friomisi Earring",
        body="Hagondes Coat",hands="Hagondes Cuffs +1",ring1="Maquette Ring",ring2="Dark Ring",
        back="Toro Cape",waist="Maniacus Sash",legs="Hagondes Pants +1",feet="Hag. Sabots +1"}
     
    sets.midcast_Stoneskin = {main="Kirin's Pole",neck="Stone Gorget",waist="Siegel Sash",legs="Shedir Seraweels"}
     
    sets.Obi = {}
    sets.Obi.Fire = {waist='Karin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Earth = {waist='Dorin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Water = {waist='Suirin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Wind = {waist='Furin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Ice = {waist='Hyorin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Thunder = {waist='Rairin Obi',back='Twilight Cape',lring='Zodiac Ring'}
    sets.Obi.Light = {waist='Korin Obi',back='Twilight Cape',lring='Zodiac Ring',main="Chatoyant Staff"}
    sets.Obi.Dark = {waist='Anrin Obi',back='Twilight Cape',lring='Zodiac Ring'}
     
    sets.staves = {}
     
    sets.staves.damage = {}
    sets.staves.damage.Thunder = {main="Apamajas I"}
    sets.staves.damage.Fire = {main="Atar I"}
     
    sets.staves.accuracy = {}
    sets.staves.damage.Thunder = {main="Apamajas II"}
    sets.staves.damage.Ice = {main="Vourukasha II"}
     
    stuntarg = 'Shantotto'
 
 
end
 
function precast(spell,action)
    if spell.skill=='Elemental Magic' then
        cast_delay(0.1)
        equip(sets['precast_FastCast'])	
    elseif spell.english == 'Stun' then
        cast_delay(0.1)
        equip(sets['precast_Stun'])
        if not buffactive.thunderstorm then
            add_to_chat(8,'--------- Thunderstorm is down ---------')
        elseif not buffactive.klimaform then
            add_to_chat(8,'----------- Klimaform is down -----------')
        end
    else
        equip(sets['precast_FastCast'])
        cast_delay(0.1)
    end
end
 
function midcast(spell,action)
    if string.find(spell.english,'Cur') then
        equip(sets.midcast_Cure)
        if spell.element == world.weather_element or spell_element == world.day_element then
            equip({main="Chatoyant Staff"},sets.Obi[spell.element])
        end
        if buffactive.rapture then
            equip({head="Savant's Bonnet +2"})
        end
    elseif spell.english == 'Impact' then
        local tempset = sets['midcast_Impact']
        tempset['body'] = 'Twilight Cloak'
        tempset['head'] = empty
        equip(tempset)
    elseif spell.skill=="Elemental Magic" then
        if string.find(spell.english,'helix') then
            equip(sets['midcast_Helix'])
			if buffactive.thunderstorm then
            equip({waist="Rairin Obi"})
			elseif buffactive.hailstorm then
			equip({waist="Hyorin Obi"})
			elseif buffactive.windstorm then
			equip({waist="Furin Obi"})
			elseif buffactive.rainstorm then
			equip({waist="Suirin Obi"})
			elseif buffactive.firestorm then
			equip({waist="Karin Obi"})
			elseif buffactive.sandstorm then
			equip({waist="Dorin Obi"})
			elseif buffactive.voidstorm then
			equip({waist="Anrin Obi"})
			elseif buffactive.aurorastorm then
			equip({waist="Korin Obi"})
			end
			if spell.element == 'Earth' then
			equip({neck="Quanpur Necklace"})
			end
        else
			equip(sets.midcast_ElementalMagic[sets.midcast_ElementalMagic.index[midcast_ElementalMagic_ind]])
			if buffactive.thunderstorm then
            equip({waist="Rairin Obi"})
			elseif buffactive.hailstorm then
			equip({waist="Hyorin Obi"})
			elseif buffactive.windstorm then
			equip({waist="Furin Obi"})
			elseif buffactive.rainstorm then
			equip({waist="Suirin Obi"})
			elseif buffactive.firestorm then
			equip({waist="Karin Obi"})
			elseif buffactive.sandstorm then
			equip({waist="Dorin Obi"})
			elseif buffactive.voidstorm then
			equip({waist="Anrin Obi"})
			elseif buffactive.aurorastorm then
			equip({waist="Korin Obi"})
			end
			if spell.element == 'Earth' then
			equip({neck="Quanpur Necklace"})
			end
        end
	
        if buffactive.ebullience then
            equip({head="Savant's Bonnet +2"})
        end
        if buffactive.klimform then
            equip ({feet="Savant's Loafers +2"})
        end
    elseif spell.skill=="Enfeebling Magic" then
		equip(sets.midcast_ElementalMagic[sets.midcast_ElementalMagic.index[midcast_ElementalMagic_ind]])

	 
	 
    elseif spell.english == 'Stoneskin' then
        equip(sets['midcast_Stoneskin'])
    elseif spell.skill == 'Enhancing Magic' then
        if spell.english == 'Embrava' or spell.english == 'Regen V' then
            equip(sets['midcast_Embrava'])
            if not buffactive.perpetuance then
                add_to_chat(8,'--------- Perpetuance is down ---------')
            end
            if not buffactive.accession then
                add_to_chat(8,'--------- Accession is down ---------')
            end
            if not buffactive.penury then
                add_to_chat(8,'--------- Penury is down ---------')
            end
        end
        if buffactive.perpetuance then
            equip(sets['midcast_EnhancingMagic'],{hands="Savant's Bracers +2"})
        else
            equip(sets['midcast_EnhancingMagic'])
        end
	elseif spell.english == 'Stun' then
		if Armor == "Lehbrailg" then 
			equip(sets.ExtremeStun)
		else
			equip(sets.aftercast_IdleStun)
		end
    end
     
    if spell.english == 'Sneak' then
        send_command('@wait 1.8;cancel 71;')
    end
end    
 
function aftercast(spell,action)
    		if Armor == '119' then
			equip(sets.aftercast_Idle119)
			elseif Armor == 'Stun' then
			equip(sets.aftercast_IdleStun)
			else
                Idle()
			end
     
    if spell.english == 'Sleep' or spell.english == 'Sleepga' then
        send_command('@wait 50;input /echo ------- '..spell.english..' is wearing off in 10 seconds -------')
    elseif spell.english == 'Sleep II' or spell.english == 'Sleepga II' then
        send_command('@wait 80;input /echo ------- '..spell.english..' is wearing off in 10 seconds -------')
    elseif spell.english == 'Break' or spell.english == 'Breakga' then
        send_command('@wait 20;input /echo ------- '..spell.english..' is wearing off in 10 seconds -------')
    end
end
 
function status_change(new,action)
        if new=='Idle' then
			if Armor == '119' then
			equip(sets.aftercast_Idle119)
			elseif Armor == 'Stun' then
			equip(sets.aftercast_IdleStun)
			else
                Idle()
			end
        elseif new=='Resting' then
                equip(sets.Resting)
        end
			if Armor == 'PDT' then
		equip(sets.PDT)
		end
end

function Idle()
	if buffactive['Sandstorm'] then
		send_command('@wait 1;input /echo ------- Sandstorm Move Wear Activated -------')
       
			equip(sets.aftercast_Move)
	elseif world.time >= (17*60) or world.time <= (7*60) then -- night time
			equip(sets.aftercast_IdleNight)
	else
			equip(sets.aftercast_IdleDay)
		end
	end
	
 
 
function buff_change(buff,gain_or_loss)
        if buff == "Sandstorm" then
                Idle()
        end
end
 
function pet_midcast(spell,action)
end
 
function pet_aftercast(spell,action)
end
 
     
	
	
function self_command(command)
    if command == 'M2' then
        midcast_ElementalMagic_ind = midcast_ElementalMagic_ind +1
        if midcast_ElementalMagic_ind > #sets.midcast_ElementalMagic.index then midcast_ElementalMagic_ind = 1 end
        send_command('@input /echo <----- TP Set changed to '..sets.midcast_ElementalMagic.index[midcast_ElementalMagic_ind]..' ----->')
        equip(sets.midcast_ElementalMagic[sets.midcast_ElementalMagic.index[midcast_ElementalMagic_ind]])
	
	elseif command == 'C7' then -- PDT Toggle --
		if Armor == 'PDT' then
			Armor = 'none'
			add_to_chat(8,'PDT Set: [Unlocked]')
		else
			Armor = 'PDT'
			add_to_chat(158,'PDT Set: [Locked]')
		end
		status_change(player.status)
	elseif command == 'C15' then -- 119 Toggle --
		if Armor == '119' then
			Armor = 'None'
			add_to_chat(8,'119 Set: [Unlocked]')
		else
			Armor = '119'
			add_to_chat(158,'119 Set: [Locked]')
		end
		status_change(player.status)
		
	elseif command == 'C30' then -- 119 Toggle --
		if Armor == 'Lehbrailg' then
			Armor = 'None'
			add_to_chat(8,'Extreme Stun: [Off]')
		else
			Armor = 'Lehbrailg'
			add_to_chat(158,'Extreme Stun: [On]')
		end
		status_change(player.status)		
		
	elseif command == 'Stun' then -- Stun Idle Toggle --
		if Armor == 'Stun' then
			Armor = 'None'
			add_to_chat(8,'Stun Set: [Unlocked]')
		else
			Armor = 'Stun'
			add_to_chat(158,'Stun Set: [Locked]')
		end
		status_change(player.status)
	end
end
 
 
-- This function is user defined, but never called by GearSwap itself. It's just a user function that's only called from user functions. I wanted to check the weather and equip a weather-based set for some spells, so it made sense to make a function for it instead of replicating the conditional in multiple places.
 
function weathercheck(spell_element,set)
    if spell_element == world.weather_element or spell_element == world.day_element then
        equip(set,sets['Obi_'..spell_element])
    else
        equip(set)
    end
end





